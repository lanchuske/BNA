<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Unidades Organizativas BNA</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; }
        select { font-size: 1.1em; }
        .section { margin-top: 2em; }
        table { border-collapse: collapse; width: 100%; margin-top: 1em; }
        th, td { border: 1px solid #ccc; padding: 0.5em; }
        th { background: #e0eaf3; }
        .title { font-size: 1.3em; font-weight: bold; margin-bottom: 0.5em; }
        .subtitle { font-weight: bold; margin-top: 1em; }
    </style>
</head>
<body>
    <h1>Unidades Organizativas BNA</h1>
    <label for="unidad-select">Selecciona una Unidad Organizativa:</label>
    <select id="unidad-select">
        <option value="">-- Selecciona --</option>
        {% for u in unidades %}
        <option value="{{u}}">{{u}}</option>
        {% endfor %}
    </select>

    <div id="unidad-content" class="section"></div>

    <script>
    document.getElementById('unidad-select').addEventListener('change', function() {
        var unidad = this.value;
        var content = document.getElementById('unidad-content');
        if (!unidad) { content.innerHTML = ''; return; }
        fetch('/unidad/' + encodeURIComponent(unidad))
            .then(r => r.json())
            .then(data => {
                if (data.error) { content.innerHTML = '<b>' + data.error + '</b>'; return; }
                let html = '';
                html += `<div class='title'>${data.nombre}</div>`;
                html += `<div><b>Misión:</b> ${data.mision || ''}</div>`;
                if (data.funciones_genericas.length) {
                    html += `<div class='subtitle'>Funciones Genéricas</div><table><tr><th>Descripción</th><th>Producto Final</th></tr>`;
                    data.funciones_genericas.forEach(f => {
                        html += `<tr><td>${f.descripcion}</td><td>${f.producto_final}</td></tr>`;
                    });
                    html += '</table>';
                }
                if (data.funciones_especificas.length) {
                    html += `<div class='subtitle'>Funciones Específicas</div><table><tr><th>Descripción</th><th>Producto Final</th><th>% Dedicación</th></tr>`;
                    data.funciones_especificas.forEach(f => {
                        html += `<tr><td>${f.descripcion}</td><td>${f.producto_final}</td><td>${f.porcentaje_dedicacion}</td></tr>`;
                    });
                    html += '</table>';
                }
                content.innerHTML = html;
            });
    });
    </script>
</body>
</html> 